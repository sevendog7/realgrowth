<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 보고서 및 인터뷰 질문 생성기</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- PDF.js and Marked.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        /* Common styles */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            border-bottom-color: #4f46e5;
            color: #4f46e5;
            font-weight: 600;
        }
        /* Report Generator Specific Styles */
        #report-generator-section #report-output h1 { font-size: 1.875rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 1.5rem; text-align: center; border-bottom: 2px solid #e2e8f0; padding-bottom: 1rem; }
        #report-generator-section #report-output h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2.5rem; margin-bottom: 1.25rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem; color: #1e3a8a; }
        #report-generator-section #report-output h3 { font-size: 1.25rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: #1e4ed8; }
        #report-generator-section #report-output ul { list-style-type: none; padding-left: 0; }
        #report-generator-section #report-output li { margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative; font-size: 1rem; }
        #report-generator-section #report-output li::before { content: "•"; position: absolute; left: 0; font-weight: 700; color: #3b82f6; font-size: 1.25rem; top: -2px; }
        #report-generator-section #report-output p { margin-bottom: 1rem; }
        #report-generator-section #report-output strong { font-weight: 700; color: #1e3a8a; }
        #report-generator-section #report-output table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; margin-bottom: 1.5rem; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        #report-generator-section #report-output th, #report-generator-section #report-output td { border: 1px solid #e2e8f0; padding: 0.75rem 1rem; text-align: left; }
        #report-generator-section #report-output th { background-color: #f8fafc; font-weight: 600; }
        #report-generator-section #report-output .footnote { font-size: 0.875rem; color: #4a5568; padding-left: 1.5rem; margin-top: -0.5rem; margin-bottom: 0.75rem; border-left: 3px solid #cbd5e1; background-color: #f8fafc; padding: 0.5rem 1rem; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">AI 기반 문서 생성기</h1>
            <p class="mt-3 text-md sm:text-lg text-slate-600">보고서 생성기와 인터뷰 질문 생성기를 한 곳에서 사용하세요.</p>
        </header>

        <!-- API Key Input -->
        <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 mb-8">
             <label for="api-key-input" class="block text-lg font-semibold text-slate-800 mb-2">API 키 입력</label>
             <input type="password" id="api-key-input" class="w-full p-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="사용자님의 API 키를 여기에 입력하세요.">
        </div>

        <!-- Tab Navigation -->
        <div class="mb-8">
            <div class="border-b border-slate-300">
                <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                    <button id="main-tab-report" class="tab-button active text-lg py-3 px-4">보고서 생성기</button>
                    <button id="main-tab-interview" class="tab-button text-lg py-3 px-4">인터뷰 질문 생성기</button>
                </nav>
            </div>
        </div>

        <!-- Generator Sections -->
        <main>
            <!-- Report Generator Section -->
            <div id="report-generator-section">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <details class="bg-slate-50 p-6 rounded-xl shadow-sm mb-8 border border-slate-200">
                        <summary class="text-xl font-semibold cursor-pointer text-slate-800 hover:text-indigo-600 transition">기획 보고서 작성 지침 보기</summary>
                        <div class="mt-4 text-slate-700 space-y-4">
                             <p>AI는 아래 지침에 따라 보고서를 생성합니다. 웹 검색과 PDF 기반 보고서 모두 동일한 지침이 적용됩니다.</p>
                            <h3 class="text-lg font-semibold text-indigo-600">1. 기본 구성 틀 (4단 구조 + 개조식)</h3>
                            <p>Ⅰ. 배경 및 필요성 → Ⅱ. 현황 및 문제점 → Ⅲ. 개선 방안 → Ⅳ. 향후 추진계획</p>
                            <h3 class="text-lg font-semibold text-indigo-600">2. 개선 방안 유형화 (3장 구조화)</h3>
                            <p>①법령·제도 ②예산·재정 ③사업·프로그램 ④인력·조직 ⑤홍보·인식 ⑥협업·연계</p>
                            <h3 class="text-lg font-semibold text-indigo-600">3. 시각화 자료 포함 원칙</h3>
                            <p>표, 그래프 등 시각자료를 포함하고 출처 명시</p>
                            <h3 class="text-lg font-semibold text-indigo-600">4. 데이터·설명 보강 (* 사용)</h3>
                            <p>통계, 설명 필요 시 아랫줄에 *로 구체 설명 삽입</p>
                            <h3 class="text-lg font-semibold text-indigo-600">5. 표현·스타일 원칙</h3>
                            <p>공무원 기획서 스타일, '핵심주제 + 수단' 조합의 제목, 한 문장=한 메시지</p>
                        </div>
                    </details>
                    
                    <div class="bg-white p-6 rounded-xl shadow-md border border-slate-200">
                        <div class="border-b border-slate-200">
                            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                <button id="report-tab-web" class="tab-button active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base">웹 검색으로 생성</button>
                                <button id="report-tab-pdf" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base">PDF로 생성</button>
                            </nav>
                        </div>
                        <div class="mt-6">
                            <div id="report-panel-web"><input type="text" id="report-topic-input" class="w-full p-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="보고서 주제를 입력하세요 (예: 청년 1인 가구 고립 문제 해결 방안)"></div>
                            <div id="report-panel-pdf" class="hidden">
                                <input type="file" id="report-pdf-file" class="hidden" accept="application/pdf">
                                <label for="report-pdf-file" class="border-2 border-dashed border-slate-300 bg-slate-50 p-8 text-center cursor-pointer rounded-lg block hover:bg-slate-100 hover:border-indigo-500">
                                    <span class="font-semibold text-indigo-600">여기를 클릭하여 PDF 파일 선택</span>
                                    <p id="report-file-name" class="mt-2 text-sm text-slate-500">선택된 파일 없음</p>
                                </label>
                            </div>
                        </div>
                        <div class="mt-6"><button id="report-generate-button" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-transform transform hover:scale-105">보고서 생성</button></div>
                    </div>

                    <div id="report-result-container" class="mt-8">
                        <div id="report-loader" class="hidden flex flex-col items-center justify-center p-10">
                            <div class="spinner"></div>
                            <p id="report-loader-text" class="mt-4 text-slate-600 font-semibold"></p>
                        </div>
                        <div id="report-error-message" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md"><p class="font-bold">오류 발생</p><p id="report-error-text"></p></div>
                        <div id="report-container" class="hidden bg-white p-8 rounded-xl shadow-lg border border-slate-200 relative">
                             <div class="absolute top-4 right-4 flex gap-2">
                                <button id="report-copy-button" title="보고서 복사" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-3 rounded-lg transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/></svg></button>
                                <button id="report-download-button" title="워드 파일로 다운로드" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-3 rounded-lg transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button>
                            </div>
                            <div id="report-output" class="prose max-w-none"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interview Question Generator Section -->
            <div id="interview-generator-section" class="hidden">
                 <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                    <div class="mb-4">
                        <label for="interview-performance-record" class="block text-lg font-semibold text-slate-800 mb-2">업무실적 기술서 내용</label>
                        <p class="text-sm text-slate-500 mb-3">파일(.txt, .pdf)을 업로드하시거나, 내용을 아래 상자에 직접 붙여넣어 주세요.</p>
                        <div class="flex items-center space-x-4 mb-3">
                            <label for="interview-file-upload" class="bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg cursor-pointer hover:bg-indigo-700 transition">
                                파일 업로드
                            </label>
                            <input type="file" id="interview-file-upload" class="hidden" accept=".txt,.pdf">
                            <span id="interview-file-name" class="text-slate-500">선택된 파일 없음</span>
                        </div>
                        <textarea id="interview-performance-record" rows="15" class="w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="이곳에 업무실적 기술서 내용을 붙여넣으세요..."></textarea>
                    </div>
                    
                    <button id="interview-generate-button" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-300 ease-in-out">
                        AI 예상 질문 생성하기
                    </button>
                </div>

                <div id="interview-loader" class="hidden flex-col items-center justify-center my-10">
                    <div class="spinner"></div>
                    <p class="mt-4 text-slate-600 font-medium">AI가 면접 질문과 답변을 생성 중입니다...</p>
                </div>

                <div id="interview-result-area" class="hidden mt-10">
                     <h2 class="text-2xl sm:text-3xl font-bold text-slate-900 text-center mb-6">AI 생성 맞춤형 인터뷰 질문 및 답변</h2>
                     <div id="interview-result-container"></div>
                </div>
            </div>
        </main>
        
        <!-- Common Error Modal -->
        <div id="error-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl max-w-sm w-full text-center">
                <h3 class="text-xl font-bold text-red-600 mb-4">오류</h3>
                <p id="error-message" class="text-slate-700 mb-6"></p>
                <button id="close-modal-button" class="bg-red-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-600 transition-colors">
                    닫기
                </button>
            </div>
        </div>

    </div>

    <script>
        // Set PDF.js worker source
        if (typeof pdfjsLib !== 'undefined') {
             pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;
        }

        // --- Global Elements & Functions ---
        const apiKeyInput = document.getElementById('api-key-input');
        const errorModal = document.getElementById('error-modal');
        const errorMessage = document.getElementById('error-message');
        const closeModalButton = document.getElementById('close-modal-button');

        function getApiKey() {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                showError('API 키를 입력해주세요.');
                return null;
            }
            return apiKey;
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorModal.classList.remove('hidden');
        }

        closeModalButton.addEventListener('click', () => errorModal.classList.add('hidden'));
        window.addEventListener('click', (event) => {
            if (event.target === errorModal) errorModal.classList.add('hidden');
        });

        // --- Main Tab Switching Logic ---
        const mainTabReport = document.getElementById('main-tab-report');
        const mainTabInterview = document.getElementById('main-tab-interview');
        const reportSection = document.getElementById('report-generator-section');
        const interviewSection = document.getElementById('interview-generator-section');

        mainTabReport.addEventListener('click', () => {
            mainTabReport.classList.add('active');
            mainTabInterview.classList.remove('active');
            reportSection.classList.remove('hidden');
            interviewSection.classList.add('hidden');
        });

        mainTabInterview.addEventListener('click', () => {
            mainTabInterview.classList.add('active');
            mainTabReport.classList.remove('active');
            interviewSection.classList.remove('hidden');
            reportSection.classList.add('hidden');
        });

        // --- Generic PDF Text Extractor ---
        async function extractTextFromPdf(file) {
            const fileReader = new FileReader();
            return new Promise((resolve, reject) => {
                fileReader.onload = async (event) => {
                    try {
                        const typedarray = new Uint8Array(event.target.result);
                        const loadingTask = pdfjsLib.getDocument(typedarray);
                        const pdf = await loadingTask.promise;
                        let fullText = '';
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            fullText += textContent.items.map(item => item.str).join(' ') + '\\n\\n';
                        }
                        resolve(fullText.trim());
                    } catch (error) {
                        reject(new Error('PDF 파일을 처리하는 중 오류가 발생했습니다.'));
                    }
                };
                fileReader.onerror = () => reject(new Error('파일을 읽는 데 실패했습니다.'));
                fileReader.readAsArrayBuffer(file);
            });
        }

        // --- Report Generator Script ---
        {
            const topicInput = document.getElementById('report-topic-input');
            const pdfFileInput = document.getElementById('report-pdf-file');
            const generateButton = document.getElementById('report-generate-button');
            const fileNameSpan = document.getElementById('report-file-name');
            const loader = document.getElementById('report-loader');
            const loaderText = document.getElementById('report-loader-text');
            const reportContainer = document.getElementById('report-container');
            const reportOutput = document.getElementById('report-output');
            const errorMessageEl = document.getElementById('report-error-message');
            const errorTextEl = document.getElementById('report-error-text');
            const copyButton = document.getElementById('report-copy-button');
            const downloadButton = document.getElementById('report-download-button');
            const tabWeb = document.getElementById('report-tab-web');
            const tabPdf = document.getElementById('report-tab-pdf');
            const panelWeb = document.getElementById('report-panel-web');
            const panelPdf = document.getElementById('report-panel-pdf');
            
            let currentMode = 'web';

            function switchTab(mode) {
                currentMode = mode;
                tabWeb.classList.toggle('active', mode === 'web');
                tabPdf.classList.toggle('active', mode !== 'web');
                panelWeb.classList.toggle('hidden', mode !== 'web');
                panelPdf.classList.toggle('hidden', mode === 'web');
            }
            tabWeb.addEventListener('click', () => switchTab('web'));
            tabPdf.addEventListener('click', () => switchTab('pdf'));

            pdfFileInput.addEventListener('change', () => {
                fileNameSpan.textContent = pdfFileInput.files.length > 0 ? pdfFileInput.files[0].name : '선택된 파일 없음';
            });
            
            generateButton.addEventListener('click', async () => {
                const apiKey = getApiKey();
                if (!apiKey) return;

                hideAllSections();
                loader.classList.remove('hidden');
                generateButton.disabled = true;
                generateButton.textContent = '생성 중...';

                try {
                    let content;
                    if (currentMode === 'web') {
                        const topic = topicInput.value.trim();
                        if (!topic) throw new Error('보고서 주제를 입력해주세요.');
                        loaderText.textContent = 'AI가 웹 검색을 통해 관련 정보를 수집하고 보고서를 작성하고 있습니다...';
                        content = topic;
                    } else {
                        if (pdfFileInput.files.length === 0) throw new Error('PDF 파일을 선택해주세요.');
                        loaderText.textContent = 'PDF 파일을 분석하고 있습니다...';
                        const file = pdfFileInput.files[0];
                        content = await extractTextFromPdf(file);
                        if (!content.trim()) throw new Error("PDF에서 텍스트를 추출할 수 없습니다.");
                        loaderText.textContent = 'AI가 PDF 내용을 기반으로 보고서를 작성하고 있습니다...';
                    }
                    
                    const report = await generateWithGemini(content, currentMode, apiKey);
                    const processedReport = report.replace(/\\n\\s*\\*/g, '\\n<p class="footnote">*');
                    reportOutput.innerHTML = marked.parse(processedReport);
                    reportContainer.classList.remove('hidden');

                } catch (error) {
                    showCustomError(error.message || '보고서 생성 중 알 수 없는 오류가 발생했습니다.');
                } finally {
                    loader.classList.add('hidden');
                    generateButton.disabled = false;
                    generateButton.textContent = '보고서 생성';
                }
            });

            async function generateWithGemini(content, mode, apiKey) {
                const basePrompt = `
                    당신은 대한민국 정부의 최고 수준의 정책기획관입니다. 당신의 임무는 주어진 주제에 대해 '기획력 평가형 보고서'를 작성하는 것입니다.
                    아래에 제시된 [보고서 서식 및 내용 작성 절대 원칙]을 단 하나의 예외도 없이, 가장 엄격한 기준으로 완벽하게 준수하여 보고서를 생성해야 합니다.
                    전체 보고서는 A4 2~3페이지 분량의 상세하고 깊이 있는 내용으로 작성되어야 합니다.
                    ---
                    **[보고서 서식 및 내용 작성 절대 원칙]**
                    **1. 제목 및 서식 (마크다운 문법만 정확히 사용):**
                    - **보고서 전체 제목:** '# [핵심주제] + [수단]' 형식.
                    - **대제목:** '## Ⅰ.', '## Ⅱ.' 와 같이 로마자 사용.
                    - **중제목:** '### □', '### ○' 와 같이 특수문자 사용.
                    - **소제목:** '- (키워드) 내용' 형식. 괄호 안에 내용을 대표하는 핵심 단어 명기. 예: - (추진 배경) 디지털 전환 가속화에 따른 정보 격차 심화
                    **2. 내용 구성 (필수 4단 구조):**
                    - Ⅰ. 배경 및 필요성, Ⅱ. 현황 및 문제점, Ⅲ. 개선 방안, Ⅳ. 향후 추진계획
                    - 각 장(Ⅰ, Ⅱ, Ⅲ, Ⅳ)은 **최소 3개 이상의 하위 항목(중제목 또는 소제목)**으로 구성되어야 합니다.
                    - 배경→문제점→개선방안→추진계획의 **명확한 논리적 흐름**을 유지해야 합니다.
                    **3. 문체 및 강조 (개조식 필수):**
                    - 보고서의 모든 내용은 **전면 개조식(bullet points, '-')**으로 작성해야 합니다. 서술형 문장(줄글)은 절대 사용하지 마십시오.
                    - 하나의 문장에는 하나의 핵심 메시지만 담아 간결하고 명확하게 표현해야 합니다.
                    - **중요한 정책 용어, 통계 수치, 핵심 전략 등은 반드시 '**굵게**' 또는 '*기울임*'으로 강조하여 가독성을 높여야 합니다.
                    **4. 'Ⅲ. 개선 방안' 작성 특별 지침:**
                    - 개선 방안은 ① (법령·제도) ② (예산·재정) ③ (사업·프로그램) ④ (인력·조직) ⑤ (홍보·인식) ⑥ (협업·연계) 중 최소 3가지 이상을 조합하여 구조화.
                    - 예시: '### □ 법령·제도 개선'
                    - 개선 방안 중 적어도 1가지 이상을 새로운 아이디어가 포함되거나 창의성을 반영해서 작성해야 합니다.
                    **5. 데이터 및 시각화 자료:**
                    - 'Ⅱ. 현황 및 문제점'에는 마크다운 테이블 형식의 표를 반드시 포함.
                `;
                
                let finalPrompt;
                if (mode === 'web') {
                    finalPrompt = `${basePrompt}\\n**[Mission]**\\n웹 검색을 통해 주제 "${content}"에 대한 보고서를 작성하세요.`;
                } else {
                    finalPrompt = `${basePrompt}\\n**[Mission]**\\n다음 PDF 내용을 심층 분석하여 보고서를 작성하세요.\\n\\n[PDF 내용 요약]\\n${content.substring(0, 15000)}`;
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: [{ text: finalPrompt }] }] };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                
                if (!response.ok) {
                     const errorBody = await response.text();
                     throw new Error(`API 호출 실패 (상태 코드: ${response.status}). 응답: ${errorBody}`);
                }
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.error("API 응답 구조:", JSON.stringify(result, null, 2));
                    throw new Error('API로부터 유효한 응답을 받지 못했습니다.');
                }
            }
            
            copyButton.addEventListener('click', () => {
                const textarea = document.createElement('textarea');
                textarea.value = reportOutput.innerText;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('보고서 내용이 복사되었습니다.');
                } catch (err) {
                    alert('클립보드 복사에 실패했습니다.');
                } finally {
                    document.body.removeChild(textarea);
                }
            });

            downloadButton.addEventListener('click', () => {
                try {
                    const reportTitle = reportOutput.querySelector('h1')?.textContent.trim() || '보고서';
                    const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>";
                    const footer = "</body></html>";
                    const sourceHTML = header + reportOutput.innerHTML + footer;
                    const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
                    const fileDownload = document.createElement("a");
                    document.body.appendChild(fileDownload);
                    fileDownload.href = source;
                    fileDownload.download = `${reportTitle.replace(/[\\/\\?%*:|"<>]/g, '-')}.doc`;
                    fileDownload.click();
                    document.body.removeChild(fileDownload);
                } catch (e) {
                    alert('워드 파일 다운로드에 실패했습니다.');
                }
            });
            
            function hideAllSections() {
                loader.classList.add('hidden');
                reportContainer.classList.add('hidden');
                errorMessageEl.classList.add('hidden');
            }
            function showCustomError(message) {
                hideAllSections();
                errorTextEl.textContent = message;
                errorMessageEl.classList.remove('hidden');
            }

            document.addEventListener('DOMContentLoaded', () => {
                hideAllSections();
                switchTab('web');
            });
        }

        // --- Interview Question Generator Script ---
        {
            const fileUpload = document.getElementById('interview-file-upload');
            const fileNameDisplay = document.getElementById('interview-file-name');
            const performanceRecordTextarea = document.getElementById('interview-performance-record');
            const generateButton = document.getElementById('interview-generate-button');
            const loader = document.getElementById('interview-loader');
            const resultArea = document.getElementById('interview-result-area');
            const resultContainer = document.getElementById('interview-result-container');

            fileUpload.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                fileNameDisplay.textContent = file.name;
                performanceRecordTextarea.value = '';

                try {
                    if (file.type === 'text/plain') {
                        performanceRecordTextarea.value = await file.text();
                    } else if (file.type === 'application/pdf') {
                        performanceRecordTextarea.value = 'PDF 파일을 분석 중입니다...';
                        const text = await extractTextFromPdf(file);
                        performanceRecordTextarea.value = text;
                    } else {
                        throw new Error('텍스트(.txt) 또는 PDF(.pdf) 파일만 업로드할 수 있습니다.');
                    }
                } catch(err) {
                    showError(err.message);
                    fileUpload.value = '';
                    fileNameDisplay.textContent = '선택된 파일 없음';
                    performanceRecordTextarea.value = '';
                }
            });

            generateButton.addEventListener('click', async () => {
                const apiKey = getApiKey();
                if (!apiKey) return;

                const recordText = performanceRecordTextarea.value.trim();
                if (!recordText || recordText === 'PDF 파일을 분석 중입니다...') {
                    showError('업무실적 기술서 내용을 입력하거나 파일을 업로드해주세요.');
                    return;
                }

                loader.classList.remove('hidden');
                loader.classList.add('flex');
                resultContainer.innerHTML = '';
                resultArea.classList.add('hidden');
                
                try {
                    const prompt = `
                    당신은 대한민국 지방공무원 5급 역량평가 인터뷰 최고 전문가입니다. 아래에 제시된 응시자의 업무실적 기술서 내용을 바탕으로, 면접관이 할 법한 가장 핵심적이고 날카로운 예상 질문 10개와 그에 대한 모범적인 답변을 생성해 주십시오.
                    각 답변은 면접관 앞에서 약 3분 내외로 발표할 수 있도록, 한국어 기준 공백 포함 2000자 내외의 풍성하고 깊이 있는 내용으로 작성해 주십시오. 
                    답변은 STAR+P 구조(Situation, Task/Problem, Action & My Role, Result, Point/Perspective)를 적용하여 작성해야 합니다.
                    ---
                    [업무실적 기술서 내용]
                    ${recordText}
                    ---
                    [출력 형식]
                    각 질문과 답변을 하나의 세트로 묶어 10개를 생성합니다. 아래 형식을 반드시 준수해 주십시오.
                    <div class="qna-item">
                      <h3>질문 1: [여기에 질문 내용]</h3>
                      <div><h4>모범 답변 (3분 발표용)</h4><p>[여기에 답변 내용]</p></div>
                    </div>
                    ...
                    <div class="qna-item">
                      <h3>질문 10: [여기에 질문 내용]</h3>
                      <div><h4>모범 답변 (3분 발표용)</h4><p>[여기에 답변 내용]</p></div>
                    </div>
                    `;
                    
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorBody = await response.json().catch(() => response.text());
                        throw new Error(`API 요청 실패: ${response.status}. 상세: ${JSON.stringify(errorBody)}`);
                    }

                    const result = await response.json();

                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        const generatedText = result.candidates[0].content.parts[0].text;
                        displayResults(generatedText);
                    } else {
                        throw new Error('API로부터 유효한 응답을 받지 못했습니다.');
                    }

                } catch (error) {
                    console.error('Error:', error);
                    showError(`질문 생성 중 오류가 발생했습니다: ${error.message}`);
                } finally {
                    loader.classList.add('hidden');
                    loader.classList.remove('flex');
                }
            });
            
            function displayResults(htmlContent) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, "text/html");
                const qnaItems = doc.querySelectorAll('.qna-item');

                if (qnaItems && qnaItems.length > 0) {
                    resultArea.classList.remove('hidden');
                    qnaItems.forEach(item => {
                        const card = document.createElement('div');
                        card.className = 'bg-white p-6 rounded-xl shadow-md border border-slate-200 mb-5 fade-in';
                        
                        const questionEl = item.querySelector('h3');
                        const answerContainer = item.querySelector('div');

                        if (questionEl && answerContainer) {
                            card.innerHTML = `
                                <h3 class="text-lg font-bold text-indigo-700 mb-3">${questionEl.innerHTML}</h3>
                                <div class="border-t border-slate-200 pt-3">${answerContainer.innerHTML}</div>
                            `;
                            resultContainer.appendChild(card);
                        }
                    });
                } else {
                    resultContainer.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-md border"><p class="text-slate-700">생성된 내용이 없습니다. 다시 시도해 주세요.</p></div>`;
                    resultArea.classList.remove('hidden');
                }
            }
        }
    </script>
</body>
</html>
